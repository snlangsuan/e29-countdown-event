(window.webpackJsonp=window.webpackJsonp||[]).push([[18,9],{503:function(e,t,n){var content=n(517);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,n(25).default)("56ae4326",content,!0,{sourceMap:!1})},504:function(e,t,n){var content=n(519);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,n(25).default)("511dd4be",content,!0,{sourceMap:!1})},516:function(e,t,n){"use strict";n(503)},517:function(e,t,n){var r=n(24)(!1);r.push([e.i,"@import url(https://fonts.googleapis.com/css2?family=Kanit:wght@100;300;400;500;600;700&display=swap);"]),r.push([e.i,'.slot-machine-box{display:flex;justify-content:center;align-items:center;font-size:8rem;font-size:Roboto,"sans-serif";margin-left:-3px}',""]),e.exports=r},518:function(e,t,n){"use strict";n(504)},519:function(e,t,n){var r=n(24)(!1);r.push([e.i,"@import url(https://fonts.googleapis.com/css2?family=Kanit:wght@100;300;400;500;600;700&display=swap);"]),r.push([e.i,".slot-machine__container[data-v-ea0fac8a]{width:100%;padding:16px 16px 8px;border-radius:4px}.slot-machine-list[data-v-ea0fac8a]{position:relative;width:100%;display:flex}.slot-machine-list[data-v-ea0fac8a],.slot-machine-list *[data-v-ea0fac8a]{-webkit-user-select:none;-moz-user-select:none;user-select:none}.slot-machine-item[data-v-ea0fac8a]{border-radius:4px;overflow:hidden;padding-top:12px;padding-bottom:12px;background-color:#fff}.slot-machine-list>.slot-machine-item+.slot-machine-item[data-v-ea0fac8a]{margin-left:8px}.slot-machine__boxes[data-v-ea0fac8a]{transition:transform 1s ease-in-out}.slot-machine__details[data-v-ea0fac8a]{margin-top:16px;font-size:5rem;text-align:center}",""]),e.exports=r},525:function(e,t,n){"use strict";n.r(t);n(28),n(52),n(27),n(9),n(64),n(69);var r=n(15),o=n(79),l=n(13);n(51),n(30),n(55),n(3),n(10),n(11),n(43),n(143),n(29),n(33);function c(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return f(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return f(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,l=!0,c=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return l=e.done,e},e:function(e){c=!0,o=e},f:function(){try{l||null==n.return||n.return()}finally{if(c)throw o}}}}function f(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,n=new Array(t);i<t;i++)n[i]=e[i];return n}var d={name:"SlotMachine",props:{items:{type:Number,default:3},message:{type:String,default:""},hideDetails:{type:Boolean,default:!1},visible:{type:Boolean,default:!0},messageColor:{type:String,default:"#000000"},color:{type:String,default:"#000000"},slotBackground:{type:String,default:"#ffffff"},backgroundColor:{type:String,default:"#ffffff00"}},data:function(){return{id:null,spinning:!1,boxSize:10,boxItems:[1,2,3,4,5,6,7,8,9,0,"X"],ro:null,audio:null}},mounted:function(){var e=this;this.id="slot-machine-"+this._uid,this.roll(),this.ro=new ResizeObserver(this.onResize),this.loadEffect(),setTimeout((function(){e.ro.observe(e.$refs[e.id]),e.onResize()}),100)},beforeDestroy:function(){this.ro.unobserve(this.$refs[this.id])},methods:{onResize:function(){var e=(this.$refs[this.id].offsetWidth-8*(this.items-1))/this.items;this.boxSize=e;var t,n=c(document.querySelectorAll(".slot-machine-box"));try{for(n.s();!(t=n.n()).done;){var r=t.value;r.style.width=this.boxSize+"px",r.style.height=this.boxSize+"px",r.style.fontSize=this.boxSize+"px"}}catch(e){n.e(e)}finally{n.f()}},loadEffect:function(){this.audio=new Audio("/sounds/spinning-eff.mp3")},resetRoll:function(){this.roll()},roll:function(e){var t=this,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,f=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,d=document.querySelectorAll(".slot-machine-item");f=Math.min(1,f);var h,m=0,v=c(d);try{var x=function(){var l=h.value;if(n)l.dataset.spinned="0";else if("1"===l.dataset.spinned)return{v:void 0};var c=l.querySelector(".slot-machine-boxes"),d=c.cloneNode(!1),v=["0"];if(!n){r=Math.min(1,r);for(var x=[],i=0;i<r;i++)x.push.apply(x,Object(o.a)(t.boxItems));v.push.apply(v,Object(o.a)(t.shuffle(x))),v.push(e[m]),d.addEventListener("transitionstart",(function(){l.dataset.spinned="1",c.querySelectorAll(".slot-machine-box").forEach((function(e){e.style.filter="blur(1px)"}))}),{once:!0}),d.addEventListener("transitionend",(function(){c.querySelectorAll(".slot-machine-box").forEach((function(e,t){e.style.filter="blur(0)",t>0&&c.removeChild(e)}))}),{once:!0})}for(var y=v.length-1;y>=0;y--){var w=document.createElement("div");w.classList.add("slot-machine-box"),w.style.width=t.boxSize+"px",w.style.height=t.boxSize+"px",w.style.fontSize=t.boxSize+"px",w.textContent=v[y],d.appendChild(w)}d.style.transitionDuration="".concat(f,"s"),d.style.transform="translateY(-".concat((l.clientHeight+1.8)*(v.length-1),"px)"),l.replaceChild(d,c),m+=1};for(v.s();!(h=v.n()).done;){var y=x();if("object"===Object(l.a)(y))return y.v}}catch(e){v.e(e)}finally{v.f()}},shuffle:function(e){for(var t=e.length;t>0;){var n=Math.floor(Math.random()*t),r=e[t-=1];e[t]=e[n],e[n]=r}return e},spin:function(code){var e=this;return Object(r.a)(regeneratorRuntime.mark((function t(){var n,r,o,l,f,d,h;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.spinning){t.next=2;break}return t.abrupt("return");case 2:t.prev=2,e.spinning=!0,e.audio&&e.audio.play(),n=("0".repeat(e.items)+code).slice(-e.items).split(""),e.roll(n,!1,1,2),r=Date.now(),o=document.querySelectorAll(".slot-machine-item"),l=c(o),t.prev=10,d=regeneratorRuntime.mark((function e(){var t,n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=f.value,n=t.querySelector(".slot-machine-boxes"),r=parseInt(n.style.transitionDuration),n.style.transform="translateY(0)",e.next=6,new Promise((function(e){return setTimeout(e,100*r)}));case 6:case"end":return e.stop()}}),e)})),l.s();case 13:if((f=l.n()).done){t.next=17;break}return t.delegateYield(d(),"t0",15);case 15:t.next=13;break;case 17:t.next=22;break;case 19:t.prev=19,t.t1=t.catch(10),l.e(t.t1);case 22:return t.prev=22,l.f(),t.finish(22);case 25:return t.next=27,new Promise((function(e){return setTimeout(e,900)}));case 27:h=Date.now(),e.audio&&e.audio.pause(),e.audio&&(e.audio.currentTime=0),console.log("start",r,"end",h,(h-r)/1e3),t.next=36;break;case 33:t.prev=33,t.t2=t.catch(2),console.error(t.t2);case 36:return t.prev=36,e.spinning=!1,t.finish(36);case 39:case"end":return t.stop()}}),t,null,[[2,33,36,39],[10,19,22,25]])})))()},show:function(code){var e=this;return Object(r.a)(regeneratorRuntime.mark((function t(){var n,r,o,l,f;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:t.prev=0,n=("0".repeat(e.items)+code).slice(-e.items).split(""),e.roll(n,!1,1,0),r=document.querySelectorAll(".slot-machine-item"),o=c(r),t.prev=5,f=regeneratorRuntime.mark((function e(){var t,n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=l.value,n=t.querySelector(".slot-machine-boxes"),r=parseInt(n.style.transitionDuration),n.style.transform="translateY(0)",e.next=6,new Promise((function(e){return setTimeout(e,100*r)}));case 6:case"end":return e.stop()}}),e)})),o.s();case 8:if((l=o.n()).done){t.next=12;break}return t.delegateYield(f(),"t0",10);case 10:t.next=8;break;case 12:t.next=17;break;case 14:t.prev=14,t.t1=t.catch(5),o.e(t.t1);case 17:return t.prev=17,o.f(),t.finish(17);case 20:t.next=25;break;case 22:t.prev=22,t.t2=t.catch(0),console.error(t.t2);case 25:return t.prev=25,e.spinning=!1,t.finish(25);case 28:case"end":return t.stop()}}),t,null,[[0,22,25,28],[5,14,17,20]])})))()}}},h=d,m=(n(516),n(518),n(63)),component=Object(m.a)(h,(function(){var e=this,t=e._self._c;return t("div",{ref:e.id,staticClass:"slot-machine__container",style:{backgroundColor:e.backgroundColor}},[t("div",{staticClass:"slot-machine-list"},[e._l(e.items,(function(i){return[t("div",{key:"item-"+i,staticClass:"slot-machine-item",style:{width:e.boxSize+"px",height:e.boxSize+24+"px",backgroundColor:e.slotBackground,color:e.color}},[t("div",{staticClass:"slot-machine-boxes"})])]}))],2),e._v(" "),e.hideDetails?e._e():t("div",{staticClass:"slot-machine__details",style:{fontSize:.7*e.boxSize+"px",color:e.messageColor}},[e._v("\n    "+e._s(e.visible?e.message:" ")+"\n  ")])])}),[],!1,null,"ea0fac8a",null);t.default=component.exports},553:function(e,t,n){var content=n(578);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,n(25).default)("f37864fe",content,!0,{sourceMap:!1})},577:function(e,t,n){"use strict";n(553)},578:function(e,t,n){var r=n(24),o=n(579),l=n(580),c=r(!1);c.push([e.i,"@import url(https://fonts.googleapis.com/css2?family=Kanit:wght@100;300;400;500;600;700&display=swap);"]);var f=o(l);c.push([e.i,".screen__container[data-v-5e71d6e9]{height:100%;margin:auto;background-repeat:no-repeat;background-size:cover}.screen__wrapper[data-v-5e71d6e9]{background-color:#ddd;background-repeat:no-repeat;background-size:cover;background-position:50%;position:relative;display:flex;flex-direction:column;align-items:center;justify-content:flex-end;border:thin solid #fafafa;cursor:none;overflow:hidden}.screen__wrapper[data-v-5e71d6e9],.screen__wrapper *[data-v-5e71d6e9]{-webkit-user-select:none;-moz-user-select:none;user-select:none}.screen-device[data-v-5e71d6e9]{position:fixed;bottom:8px;right:16px;text-align:right;font-size:.6rem;color:#ddd}.screen-item[data-v-5e71d6e9]{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center}.screen-winner[data-v-5e71d6e9]{margin-top:16px}.screen-winner--text[data-v-5e71d6e9]{font-size:5rem}.screen-btn[data-v-5e71d6e9]{width:200px;height:200px;background-image:url("+f+");background-position:50%;background-repeat:no-repeat;background-size:contain;box-sizing:border-box;cursor:pointer;-webkit-user-select:none;-webkit-touch-callout:none;-moz-user-select:none;user-select:none}.screen-btn[data-v-5e71d6e9]:disabled{cursor:not-allowed;filter:grayscale(100%)}.screen-mode-btn[data-v-5e71d6e9]{width:100px;height:100px;background-color:#fff;border:thin solid #ddd;border-radius:4px;margin-left:auto;margin-right:auto;cursor:pointer;-webkit-user-select:none;-webkit-touch-callout:none;-moz-user-select:none;user-select:none}.screen-mode-btn[data-v-5e71d6e9]:disabled{cursor:not-allowed;filter:grayscale(100%)}",""]),e.exports=c},579:function(e,t,n){"use strict";e.exports=function(e,t){return t||(t={}),"string"!=typeof(e=e&&e.__esModule?e.default:e)?e:(/^['"].*['"]$/.test(e)&&(e=e.slice(1,-1)),t.hash&&(e+=t.hash),/["'() \t\n]/.test(e)||t.needQuotes?'"'.concat(e.replace(/"/g,'\\"').replace(/\n/g,"\\n"),'"'):e)}},580:function(e,t,n){e.exports=n.p+"img/stage-btn.5961cfb.png"},611:function(e,t,n){"use strict";n.r(t);n(28),n(41),n(12),n(9),n(17),n(10),n(18);var r=n(15),o=n(2),l=(n(43),n(11),n(3),n(51),n(217)),c=n.n(l);function f(object,e){var t=Object.keys(object);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(object);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(object,e).enumerable}))),t.push.apply(t,n)}return t}function d(e){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?f(Object(source),!0).forEach((function(t){Object(o.a)(e,t,source[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(source)):f(Object(source)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(source,t))}))}return e}var h={name:"StageMainPage",layout:"empty",middleware:"auth",data:function(){return{state:"wait",spinning:!0,showWinner:!1,isSpinDevice:!1,hasRegistrants:!1,slotLen:10,buttonSize:100,backgroundImage:null,winner:{name:"",telno:""},error:{show:!1,messages:[]},settings:{width:1280,height:720,background:{url:null,image:null,path:null,mode:"color",color:"#DDDDDD"},button:{size:180,padding_top:32,padding_bottom:32,background:{url:null,image:null,path:null}},slot:{width:1240,name_color:"#000000",number_color:"#000000",number_background:"#ffffff",background_color:"#ffffff00"}}}},computed:{screenStyle:function(){var e="color"===this.settings.background.mode?{backgroundColor:this.settings.background.color}:{backgroundImage:"url("+this.settings.background.url+")"};return d({width:this.settings.width+"px",height:this.settings.height+"px"},e)},slotStyle:function(){return{width:this.settings.slot.width+"px"}},screenButtonStyle:function(){return{paddingTop:this.settings.button.padding_top+"px",paddingBottom:this.settings.button.padding_bottom+"px"}},buttonStyle:function(){return{width:this.settings.button.size+"px",height:this.settings.button.size+"px",backgroundImage:"url("+this.settings.button.background.url+")",backgroundColor:this.settings.button.background.url?"transparent":"#ffffff"}}},mounted:function(){this.init(),this.initEvent()},methods:{onResize:function(){var e=window.innerHeight;this.buttonSize=.25*e},init:function(){try{var e=this.loadRegistrants();console.log(e),this.hasRegistrants=e&&e.length>0}catch(e){this.error.messages=[e.message],this.error.show=!1}},initEvent:function(){var e=this;this.$fire.database.ref("stage").on("value",(function(t){var n=t.val();if(e.onOffloadRegistrants(n.offline_version),e.backgroundImage=((n.settings||{}).main||{}).bg_url,!e.isSpinDevice){e.state=n.state;var r=n.winner;e.winner=r,console.log(e.state),"spinning"===e.state?e.onSpinning():"spined"===e.state&&(e.onSpined(),e.showWinner=!0)}"0000000000"===e.winner.telno&&(e.$refs.slot_machine&&e.$refs.slot_machine.resetRoll(),e.showWinner=!1)})),this.$fire.database.ref("settings/stages/main").on("value",this.loadSettings)},loadSettings:function(e){try{var t=e.val()||{};this.settings.width=t.width||1280,this.settings.height=t.height||720;var n=t.background||{};this.settings.background.mode=n.mode||"color",this.settings.background.color=n.color||"#DDDDDD",this.settings.background.url=n.url||null,this.settings.background.path=n.path||null,this.settings.background.image=null;var button=t.button||{};this.settings.button.size=button.size||180,this.settings.button.padding_top=button.padding_top||32,this.settings.button.padding_bottom=button.padding_bottom||32;var r=button.background||{};this.settings.button.background.url=r.url||null,this.settings.button.background.path=r.path||null,this.settings.button.background.image=null;var slot=t.slot||{};this.settings.slot.width=slot.width||1240,this.settings.slot.name_color=slot.name_color||"#000000",this.settings.slot.number_color=slot.number_color||"#000000",this.settings.slot.number_background=slot.number_background||"#ffffff",this.settings.slot.background_color=slot.background_color||"#ffffff00"}catch(e){console.error(e)}},handleOnSpin:function(){var e=this;return Object(r.a)(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,e.showWinner=!1,e.isSpinDevice=!0,e.spinning=!1,(n=e.getWinner()).telno){t.next=7;break}return t.abrupt("return");case 7:return e.winner=n,t.next=10,e.$fire.database.ref("stage").update({winner:n,state:"spinning"});case 10:return e.state="spinning",t.next=13,e.onSpinning();case 13:return t.next=15,e.$fire.database.ref("stage").update({state:"spined"});case 15:return t.next=17,e.$fire.database.ref("winner_logs").push(d(d({},n),{},{created_at:c()().format("YYYY-MM-DD HH:mm:ss")}));case 17:e.state="spined",t.next=23;break;case 20:t.prev=20,t.t0=t.catch(0),console.error(t.t0);case 23:return t.prev=23,e.showWinner=!0,e.spinning=!1,e.isSpinDevice=!1,t.finish(23);case 28:case"end":return t.stop()}}),t,null,[[0,20,23,28]])})))()},onSpinning:function(){var e=this;return Object(r.a)(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.winner.telno.slice(0,-3)+"xxx",e.$refs.slot_machine&&e.$refs.slot_machine.resetRoll(),t.next=4,e.$refs.slot_machine.spin(n);case 4:case"end":return t.stop()}}),t)})))()},onSpined:function(){var e=this;return Object(r.a)(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.winner.telno.slice(0,-3)+"xxx",console.log(e.$refs.slot_machine),e.$refs.slot_machine&&e.$refs.slot_machine.resetRoll(),t.next=5,e.$refs.slot_machine.show(n);case 5:case"end":return t.stop()}}),t)})))()},getWinner:function(){try{var e=this.loadRegistrants();console.log("before get winner",e.length);var t=e[Math.floor(Math.random()*e.length)],filter=e.filter((function(e){return e.telno!==t.telno}));return localStorage.setItem("offline_registrants",JSON.stringify(filter)),this.hasRegistrants=filter&&filter.length>0,console.log("after get winner",filter.length),t}catch(e){console.error(e)}},onOffloadRegistrants:function(e){var t=this;return Object(r.a)(regeneratorRuntime.mark((function n(){var r,o,l;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(n.prev=0,r=localStorage.getItem("offline_version"),console.log("load registrants",e,r),r===e+""){n.next=11;break}return n.next=6,t.$fire.database.ref("registrants").once("value");case 6:o=n.sent,l=o.val(),localStorage.setItem("offline_registrants",JSON.stringify(l)),localStorage.setItem("offline_version",e),t.hasRegistrants=l&&l.length>0;case 11:n.next=16;break;case 13:n.prev=13,n.t0=n.catch(0),console.error(n.t0);case 16:case"end":return n.stop()}}),n,null,[[0,13]])})))()},loadRegistrants:function(){try{return JSON.parse(localStorage.getItem("offline_registrants")||"[]")}catch(e){return[]}}}},m=(n(577),n(63)),component=Object(m.a)(h,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"screen__container"},[t("div",{staticClass:"screen__wrapper",style:e.screenStyle},[t("div",{staticClass:"screen__slot",style:e.slotStyle},[t("slot-machine",{ref:"slot_machine",attrs:{items:e.slotLen,message:"คุณ"+e.winner.name,visible:e.showWinner,"message-color":e.settings.slot.name_color,color:e.settings.slot.number_color,"slot-background":e.settings.slot.number_background,"background-color":e.settings.slot.background_color}})],1),e._v(" "),t("div",{staticClass:"screen__button",style:e.screenButtonStyle},[t("button",{staticClass:"screen-btn",style:e.buttonStyle,attrs:{disabled:!e.hasRegistrants||["wait","spined","spinning"].includes(e.state)},on:{click:e.handleOnSpin}})])])])}),[],!1,null,"5e71d6e9",null);t.default=component.exports;installComponents(component,{SlotMachine:n(525).default})}}]);